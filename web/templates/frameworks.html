{% extends "base.html" %}

{% block title %}AI Frameworks{% endblock %}

{% block content %}
<div class="hero-section" style="padding: 2rem 0;">
    <div class="container">
        <h1 class="mb-2"><i class="fas fa-sitemap me-2"></i>Enterprise AI Framework Generator</h1>
        <p class="lead mb-0">Build comprehensive, board-ready AI frameworks tailored to {{ organization }}</p>
    </div>
</div>

<div class="container">
    <!-- Framework Cards - Row 1 -->
    <div class="row g-4 mb-4">
        <!-- AI Strategy Framework -->
        <div class="col-lg-4">
            <div class="card h-100 framework-card">
                <div class="card-header bg-primary text-white">
                    <i class="fas fa-chess me-2"></i>AI Strategy Framework
                </div>
                <div class="card-body">
                    <p class="text-muted">Define your AI vision, strategic pillars, OKRs, and implementation approach aligned with business objectives.</p>
                    <ul class="small text-muted mb-4">
                        <li>7 Strategic pillars with OKRs</li>
                        <li>Talent strategy & team structure</li>
                        <li>Technology recommendations</li>
                        <li>Investment & ROI projections</li>
                        <li>4-phase implementation roadmap</li>
                    </ul>
                    <button class="btn btn-primary w-100" onclick="generateFramework('strategy')">
                        <i class="fas fa-magic me-2"></i>Generate Strategy
                    </button>
                </div>
            </div>
        </div>

        <!-- Governance Framework -->
        <div class="col-lg-4">
            <div class="card h-100 framework-card">
                <div class="card-header bg-success text-white">
                    <i class="fas fa-shield-alt me-2"></i>AI Governance Framework
                </div>
                <div class="card-body">
                    <p class="text-muted">Establish policies, Three Lines of Defense, RACI matrices, and controls for responsible AI.</p>
                    <ul class="small text-muted mb-4">
                        <li>Three Lines of Defense model</li>
                        <li>10+ comprehensive policies</li>
                        <li>RACI matrices for governance</li>
                        <li>Risk-tiered approval workflows</li>
                        <li>Sector-specific compliance</li>
                    </ul>
                    <button class="btn btn-success w-100" onclick="generateFramework('governance')">
                        <i class="fas fa-magic me-2"></i>Generate Governance
                    </button>
                </div>
            </div>
        </div>

        <!-- Ethics Framework -->
        <div class="col-lg-4">
            <div class="card h-100 framework-card">
                <div class="card-header bg-info text-white">
                    <i class="fas fa-balance-scale me-2"></i>AI Ethics Framework
                </div>
                <div class="card-body">
                    <p class="text-muted">Define ethical principles with EU AI Act compliance, NIST AI RMF alignment, and bias frameworks.</p>
                    <ul class="small text-muted mb-4">
                        <li>EU AI Act compliance framework</li>
                        <li>NIST AI RMF integration</li>
                        <li>Algorithmic Impact Assessment</li>
                        <li>Comprehensive bias audit framework</li>
                        <li>Ethics Board structure</li>
                    </ul>
                    <button class="btn btn-info w-100" onclick="generateFramework('ethics')">
                        <i class="fas fa-magic me-2"></i>Generate Ethics
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Framework Cards - Row 2 -->
    <div class="row g-4 mb-4">
        <!-- MLOps Framework -->
        <div class="col-lg-6">
            <div class="card h-100 framework-card">
                <div class="card-header bg-warning text-dark">
                    <i class="fas fa-cogs me-2"></i>MLOps Framework
                </div>
                <div class="card-body">
                    <p class="text-muted">Build production-ready ML infrastructure with lifecycle management, deployment patterns, and monitoring.</p>
                    <div class="row">
                        <div class="col-6">
                            <ul class="small text-muted mb-4">
                                <li>ML lifecycle management</li>
                                <li>Feature store architecture</li>
                                <li>Experiment tracking</li>
                                <li>Model registry & versioning</li>
                            </ul>
                        </div>
                        <div class="col-6">
                            <ul class="small text-muted mb-4">
                                <li>Deployment patterns (canary, A/B)</li>
                                <li>Monitoring & observability</li>
                                <li>CI/CD for ML pipelines</li>
                                <li>Tool recommendations</li>
                            </ul>
                        </div>
                    </div>
                    <button class="btn btn-warning w-100" onclick="generateFramework('mlops')">
                        <i class="fas fa-magic me-2"></i>Generate MLOps
                    </button>
                </div>
            </div>
        </div>

        <!-- Data Strategy Framework -->
        <div class="col-lg-6">
            <div class="card h-100 framework-card">
                <div class="card-header bg-secondary text-white">
                    <i class="fas fa-database me-2"></i>Data Strategy Framework
                </div>
                <div class="card-body">
                    <p class="text-muted">Enable AI with comprehensive data governance, architecture, quality management, and compliance.</p>
                    <div class="row">
                        <div class="col-6">
                            <ul class="small text-muted mb-4">
                                <li>Data governance framework</li>
                                <li>Data architecture patterns</li>
                                <li>Data quality management</li>
                                <li>Data catalog & discovery</li>
                            </ul>
                        </div>
                        <div class="col-6">
                            <ul class="small text-muted mb-4">
                                <li>Security & privacy controls</li>
                                <li>Master data management</li>
                                <li>Data for AI/ML practices</li>
                                <li>Regulatory compliance</li>
                            </ul>
                        </div>
                    </div>
                    <button class="btn btn-secondary w-100" onclick="generateFramework('data-strategy')">
                        <i class="fas fa-magic me-2"></i>Generate Data Strategy
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Framework Output -->
    <div class="card" id="frameworkOutput" style="display: none;">
        <div class="card-header d-flex justify-content-between align-items-center">
            <span id="frameworkTitle"><i class="fas fa-file-alt me-2"></i>Generated Framework</span>
            <div>
                <button class="btn btn-sm btn-outline-primary me-2" onclick="downloadFramework()">
                    <i class="fas fa-download me-1"></i>Download JSON
                </button>
                <button class="btn btn-sm btn-outline-secondary" onclick="closeFramework()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="card-body" id="frameworkContent" style="max-height: 800px; overflow-y: auto;">
            <!-- Dynamic content -->
        </div>
    </div>

    <!-- Loading State -->
    <div class="card" id="loadingCard" style="display: none;">
        <div class="card-body text-center py-5">
            <span class="loading-spinner" style="width: 40px; height: 40px;"></span>
            <h5 class="mt-3">Generating Enterprise Framework...</h5>
            <p class="text-muted mb-0">Building comprehensive, board-ready framework from your assessment data.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.framework-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.section-header {
    background: linear-gradient(135deg, var(--patriot-primary) 0%, var(--patriot-secondary) 100%);
    color: white;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
}

.subsection-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
    border-left: 4px solid var(--patriot-accent);
}

.metric-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    background: var(--patriot-accent);
    color: white;
    border-radius: 4px;
    font-size: 0.75rem;
    margin-right: 0.5rem;
    margin-bottom: 0.25rem;
}

.framework-nav {
    position: sticky;
    top: 1rem;
}

.framework-nav .nav-link {
    padding: 0.5rem 1rem;
    border-radius: 4px;
    color: var(--patriot-primary);
}

.framework-nav .nav-link.active {
    background: var(--patriot-primary);
    color: white;
}

.data-table {
    font-size: 0.875rem;
}

.data-table th {
    background: #f8f9fa;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
let currentFramework = null;
let currentType = null;

async function generateFramework(type) {
    document.getElementById('loadingCard').style.display = 'block';
    document.getElementById('frameworkOutput').style.display = 'none';
    currentType = type;

    try {
        const response = await apiCall(`/api/frameworks/${type}`, 'POST');
        currentFramework = response;
        displayFramework(type, response);
    } catch (error) {
        console.error('Failed to generate framework:', error);
        alert('Failed to generate framework. Please try again.');
    } finally {
        document.getElementById('loadingCard').style.display = 'none';
    }
}

function displayFramework(type, data) {
    const titles = {
        'strategy': '<i class="fas fa-chess me-2"></i>AI Strategy Framework',
        'governance': '<i class="fas fa-shield-alt me-2"></i>AI Governance Framework',
        'ethics': '<i class="fas fa-balance-scale me-2"></i>AI Ethics Framework',
        'mlops': '<i class="fas fa-cogs me-2"></i>MLOps Framework',
        'data-strategy': '<i class="fas fa-database me-2"></i>Data Strategy Framework'
    };

    document.getElementById('frameworkTitle').innerHTML = titles[type] || 'Generated Framework';

    let html = '';
    if (type === 'strategy') {
        html = renderStrategyFramework(data);
    } else if (type === 'governance') {
        html = renderGovernanceFramework(data);
    } else if (type === 'ethics') {
        html = renderEthicsFramework(data);
    } else if (type === 'mlops') {
        html = renderMLOpsFramework(data);
    } else if (type === 'data-strategy') {
        html = renderDataStrategyFramework(data);
    }

    document.getElementById('frameworkContent').innerHTML = html;
    document.getElementById('frameworkOutput').style.display = 'block';
    document.getElementById('frameworkOutput').scrollIntoView({ behavior: 'smooth' });
}

function renderStrategyFramework(data) {
    let html = `
        <div class="mb-4">
            <h4>${data.organization_name || 'Organization'} AI Strategy</h4>
            <p class="lead">${data.vision || data.strategic_vision || 'Strategic vision for AI transformation'}</p>
        </div>
    `;

    // Strategic Pillars
    if (data.strategic_pillars && data.strategic_pillars.length > 0) {
        html += '<div class="section-header"><i class="fas fa-columns me-2"></i>Strategic Pillars</div>';
        html += '<div class="row g-3 mb-4">';
        data.strategic_pillars.forEach((pillar, idx) => {
            html += `
                <div class="col-md-6 col-lg-4">
                    <div class="subsection-card h-100">
                        <h6><span class="badge bg-primary me-2">${idx + 1}</span>${pillar.name || pillar.pillar}</h6>
                        <p class="small text-muted mb-2">${pillar.description || ''}</p>
                        ${pillar.strategic_objective ? `<p class="small"><strong>Objective:</strong> ${pillar.strategic_objective}</p>` : ''}
                        ${pillar.initiatives && pillar.initiatives.length > 0 ? `
                            <div class="small"><strong>Key Initiatives:</strong>
                            <ul class="mb-0 mt-1">${pillar.initiatives.slice(0, 4).map(i => `<li>${typeof i === 'string' ? i : i.name || i}</li>`).join('')}</ul>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        });
        html += '</div>';
    }

    // Investment Summary
    if (data.investment_summary) {
        html += '<div class="section-header"><i class="fas fa-dollar-sign me-2"></i>Investment Summary</div>';
        html += '<div class="subsection-card mb-4">';
        const inv = data.investment_summary;
        if (inv.total_investment) html += `<p><strong>Total Investment:</strong> ${inv.total_investment}</p>`;
        if (inv.expected_roi) html += `<p><strong>Expected ROI:</strong> ${inv.expected_roi}</p>`;
        if (inv.payback_period) html += `<p><strong>Payback Period:</strong> ${inv.payback_period}</p>`;
        html += '</div>';
    }

    // Implementation Roadmap
    if (data.implementation_roadmap && data.implementation_roadmap.length > 0) {
        html += '<div class="section-header"><i class="fas fa-road me-2"></i>Implementation Roadmap</div>';
        html += '<div class="row g-3 mb-4">';
        data.implementation_roadmap.forEach(phase => {
            html += `
                <div class="col-md-6 col-lg-3">
                    <div class="subsection-card h-100">
                        <h6>${phase.phase || phase.name}</h6>
                        <p class="small text-muted">${phase.timeline || phase.duration || ''}</p>
                        <p class="small">${phase.focus || phase.description || ''}</p>
                        ${phase.objectives ? `<ul class="small mb-0">${phase.objectives.slice(0, 3).map(o => `<li>${o}</li>`).join('')}</ul>` : ''}
                    </div>
                </div>
            `;
        });
        html += '</div>';
    }

    return html;
}

function renderGovernanceFramework(data) {
    let html = `
        <div class="mb-4">
            <h4>${data.organization_name || 'Organization'} AI Governance Framework</h4>
            <p class="text-muted">Version: ${data.version || '1.0'} | Sector: ${data.sector || 'General'}</p>
        </div>
    `;

    // Three Lines of Defense
    if (data.three_lines_of_defense) {
        html += '<div class="section-header"><i class="fas fa-shield-alt me-2"></i>Three Lines of Defense Model</div>';
        html += '<div class="row g-3 mb-4">';
        Object.entries(data.three_lines_of_defense).forEach(([key, line]) => {
            if (line && typeof line === 'object') {
                html += `
                    <div class="col-md-4">
                        <div class="subsection-card h-100">
                            <h6>${line.name || key}</h6>
                            <p class="small text-muted">${line.description || ''}</p>
                            ${line.responsibilities ? `<ul class="small mb-0">${line.responsibilities.slice(0, 4).map(r => `<li>${r}</li>`).join('')}</ul>` : ''}
                        </div>
                    </div>
                `;
            }
        });
        html += '</div>';
    }

    // Policies
    if (data.policies && data.policies.length > 0) {
        html += '<div class="section-header"><i class="fas fa-file-contract me-2"></i>Key Policies</div>';
        html += '<div class="accordion mb-4" id="policyAccordion">';
        data.policies.slice(0, 6).forEach((policy, idx) => {
            html += `
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button ${idx > 0 ? 'collapsed' : ''}" type="button"
                                data-bs-toggle="collapse" data-bs-target="#policy${idx}">
                            ${policy.name || policy.policy_name}
                        </button>
                    </h2>
                    <div id="policy${idx}" class="accordion-collapse collapse ${idx === 0 ? 'show' : ''}"
                         data-bs-parent="#policyAccordion">
                        <div class="accordion-body">
                            <p><strong>Purpose:</strong> ${policy.purpose || ''}</p>
                            ${policy.key_provisions || policy.provisions ? `
                                <p><strong>Key Provisions:</strong></p>
                                <ul class="small">
                                    ${(policy.key_provisions || policy.provisions || []).slice(0, 5).map(p => `<li>${typeof p === 'string' ? p : p.name || p}</li>`).join('')}
                                </ul>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        });
        html += '</div>';
    }

    // RACI Matrix
    if (data.raci_matrix) {
        html += '<div class="section-header"><i class="fas fa-table me-2"></i>RACI Matrix</div>';
        html += '<div class="subsection-card mb-4"><p class="small text-muted">Comprehensive RACI matrix available in JSON download with 12+ governance activities mapped to roles.</p></div>';
    }

    // Model Lifecycle Governance
    if (data.model_lifecycle_governance) {
        html += '<div class="section-header"><i class="fas fa-sync me-2"></i>Model Lifecycle Governance</div>';
        html += '<div class="subsection-card mb-4"><p class="small text-muted">Stage-gate governance with 9 lifecycle stages and gate criteria included in full framework.</p></div>';
    }

    return html;
}

function renderEthicsFramework(data) {
    let html = `
        <div class="mb-4">
            <h4>${data.organization_name || 'Organization'} AI Ethics Framework</h4>
            <p class="lead">${data.vision_statement ? data.vision_statement.substring(0, 200) + '...' : 'Commitment to responsible and ethical AI'}</p>
        </div>
    `;

    // EU AI Act Compliance
    if (data.eu_ai_act_compliance) {
        html += '<div class="section-header"><i class="fas fa-gavel me-2"></i>EU AI Act Compliance</div>';
        html += '<div class="subsection-card mb-4">';
        html += '<p class="small">Risk-based classification with requirements for Unacceptable, High, Limited, and Minimal risk AI systems.</p>';
        if (data.eu_ai_act_compliance.risk_classification) {
            html += '<div class="row">';
            Object.entries(data.eu_ai_act_compliance.risk_classification).forEach(([key, val]) => {
                if (val && typeof val === 'object') {
                    html += `<div class="col-md-3"><span class="metric-badge">${key.replace('_', ' ')}</span></div>`;
                }
            });
            html += '</div>';
        }
        html += '</div>';
    }

    // Ethical Principles
    if (data.ethical_principles && data.ethical_principles.length > 0) {
        html += '<div class="section-header"><i class="fas fa-balance-scale me-2"></i>Core Ethical Principles</div>';
        html += '<div class="row g-3 mb-4">';
        data.ethical_principles.slice(0, 6).forEach(principle => {
            html += `
                <div class="col-md-6">
                    <div class="subsection-card h-100">
                        <h6>${principle.principle || principle.name}</h6>
                        <p class="small text-muted mb-2">${(principle.definition || principle.description || '').substring(0, 150)}...</p>
                        ${principle.requirements ? `<p class="small"><strong>Requirements:</strong> ${principle.requirements.slice(0, 2).join(', ')}</p>` : ''}
                    </div>
                </div>
            `;
        });
        html += '</div>';
    }

    // Bias Audit Framework
    if (data.bias_audit_framework) {
        html += '<div class="section-header"><i class="fas fa-search me-2"></i>Bias Audit Framework</div>';
        html += '<div class="subsection-card mb-4">';
        html += '<p class="small">Comprehensive bias detection and mitigation framework with statistical testing protocols for protected attributes.</p>';
        html += '<p class="small"><strong>Bias Types Covered:</strong> Historical, Representation, Measurement, Aggregation, Evaluation, Deployment</p>';
        html += '</div>';
    }

    // Ethics Board Structure
    if (data.ethics_board_structure) {
        html += '<div class="section-header"><i class="fas fa-users me-2"></i>Ethics Board Structure</div>';
        html += '<div class="subsection-card mb-4">';
        html += '<p class="small">Multi-stakeholder Ethics Board with defined authority, composition, meeting cadence, and reporting structure.</p>';
        html += '</div>';
    }

    return html;
}

function renderMLOpsFramework(data) {
    let html = `
        <div class="mb-4">
            <h4>${data.organization_name || 'Organization'} MLOps Framework</h4>
            <p class="text-muted">Maturity Level: ${data.maturity_assessment?.current_level || 'Developing'}</p>
        </div>
    `;

    // ML Lifecycle
    if (data.ml_lifecycle && data.ml_lifecycle.stages) {
        html += '<div class="section-header"><i class="fas fa-sync me-2"></i>ML Lifecycle Stages</div>';
        html += '<div class="row g-2 mb-4">';
        Object.entries(data.ml_lifecycle.stages).forEach(([key, stage]) => {
            if (stage && typeof stage === 'object') {
                html += `
                    <div class="col-md-4 col-lg-3">
                        <div class="subsection-card h-100 text-center">
                            <h6 class="small">${stage.description || key}</h6>
                        </div>
                    </div>
                `;
            }
        });
        html += '</div>';
    }

    // Deployment Framework
    if (data.deployment_framework && data.deployment_framework.deployment_patterns) {
        html += '<div class="section-header"><i class="fas fa-rocket me-2"></i>Deployment Patterns</div>';
        html += '<div class="row g-3 mb-4">';
        Object.entries(data.deployment_framework.deployment_patterns).slice(0, 4).forEach(([key, pattern]) => {
            if (pattern && typeof pattern === 'object') {
                html += `
                    <div class="col-md-6 col-lg-3">
                        <div class="subsection-card h-100">
                            <h6 class="small">${key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</h6>
                            <p class="small text-muted">${pattern.description || ''}</p>
                        </div>
                    </div>
                `;
            }
        });
        html += '</div>';
    }

    // Monitoring
    if (data.monitoring_observability) {
        html += '<div class="section-header"><i class="fas fa-chart-line me-2"></i>Monitoring & Observability</div>';
        html += '<div class="subsection-card mb-4">';
        html += '<p class="small">Comprehensive monitoring for model performance, data drift, concept drift, and operational metrics with alerting and dashboards.</p>';
        html += '</div>';
    }

    // Tool Recommendations
    if (data.tool_recommendations && data.tool_recommendations.recommended_stack) {
        html += '<div class="section-header"><i class="fas fa-tools me-2"></i>Recommended Tool Stack</div>';
        html += '<div class="row g-3 mb-4">';
        Object.entries(data.tool_recommendations.recommended_stack).forEach(([stack, tools]) => {
            html += `
                <div class="col-md-6">
                    <div class="subsection-card h-100">
                        <h6 class="small">${stack.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</h6>
                        <ul class="small mb-0">
                            ${Object.entries(tools).map(([cat, tool]) => `<li><strong>${cat}:</strong> ${tool}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
        });
        html += '</div>';
    }

    return html;
}

function renderDataStrategyFramework(data) {
    let html = `
        <div class="mb-4">
            <h4>${data.organization_name || 'Organization'} Data Strategy</h4>
            <p class="lead">${data.vision_and_principles?.vision || 'Data as a strategic asset for AI excellence'}</p>
        </div>
    `;

    // Data Principles
    if (data.vision_and_principles && data.vision_and_principles.principles) {
        html += '<div class="section-header"><i class="fas fa-compass me-2"></i>Data Principles</div>';
        html += '<div class="row g-3 mb-4">';
        Object.entries(data.vision_and_principles.principles).forEach(([key, principle]) => {
            if (principle && typeof principle === 'object') {
                html += `
                    <div class="col-md-6 col-lg-4">
                        <div class="subsection-card h-100">
                            <h6 class="small">${principle.principle || key}</h6>
                            <p class="small text-muted">${principle.description || ''}</p>
                        </div>
                    </div>
                `;
            }
        });
        html += '</div>';
    }

    // Data Governance
    if (data.data_governance) {
        html += '<div class="section-header"><i class="fas fa-sitemap me-2"></i>Data Governance</div>';
        html += '<div class="subsection-card mb-4">';
        html += '<p class="small">Federated governance model with Data Governance Council, Data Owners, Data Stewards, and Data Custodians.</p>';
        if (data.data_governance.policies) {
            html += '<p class="small"><strong>Key Policies:</strong> Data Classification, Retention, Access Control, Data Quality</p>';
        }
        html += '</div>';
    }

    // Data Architecture
    if (data.data_architecture) {
        html += '<div class="section-header"><i class="fas fa-layer-group me-2"></i>Data Architecture</div>';
        html += '<div class="row g-3 mb-4">';
        if (data.data_architecture.architecture_patterns) {
            Object.entries(data.data_architecture.architecture_patterns).forEach(([key, pattern]) => {
                if (pattern && typeof pattern === 'object') {
                    html += `
                        <div class="col-md-4">
                            <div class="subsection-card h-100">
                                <h6 class="small">${key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</h6>
                                <p class="small text-muted">${pattern.description || ''}</p>
                            </div>
                        </div>
                    `;
                }
            });
        }
        html += '</div>';
    }

    // Data Quality
    if (data.data_quality) {
        html += '<div class="section-header"><i class="fas fa-check-circle me-2"></i>Data Quality Framework</div>';
        html += '<div class="subsection-card mb-4">';
        html += '<p class="small">Six quality dimensions: Accuracy, Completeness, Consistency, Timeliness, Validity, Uniqueness.</p>';
        html += '<p class="small"><strong>Process:</strong> Define → Measure → Analyze → Improve → Monitor</p>';
        html += '</div>';
    }

    // Data for AI
    if (data.data_for_ai) {
        html += '<div class="section-header"><i class="fas fa-brain me-2"></i>Data for AI/ML</div>';
        html += '<div class="subsection-card mb-4">';
        html += '<p class="small">Feature store architecture, training data management, data labeling practices, and governance for AI.</p>';
        html += '</div>';
    }

    return html;
}

function downloadFramework() {
    if (!currentFramework) return;

    const content = JSON.stringify(currentFramework, null, 2);
    const blob = new Blob([content], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${currentType || 'ai'}-framework.json`;
    a.click();
    URL.revokeObjectURL(url);
}

function closeFramework() {
    document.getElementById('frameworkOutput').style.display = 'none';
}
</script>
{% endblock %}
